<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html lang="ko">
<head>
  <title>Bootstrap Example</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>
<div class="container">
	<div class="row">
		<h3>박스오피스 조회</h3>
	</div>
	<div class="row">
		<form class="form-horizontal well">
			<div class="form-group">
				<label class="control-label col-sm-2">조회날짜</label>
				<div class="col-sm-9">
					<input type="date" class="form-control" name="searchdate" id="search-date" />
				</div>
				<div class="col-sm-1">
					<button type="submit" class="btn btn-default" id="btn-search">조회</button>
				</div>
			</div>
		</form>
	</div>
	<div class="row">
		<table class="table table-striped table-condensed">
			<thead>
				<tr>
					<th>순위</th>
					<th>제목</th>
					<th>개봉일</th>
					<th>일일 관객수</th>
					<th>누적 관객수</th>
					<th>누적 매출액</th>
					<th>스크린 수</th>
				</tr>
			</thead>
			<tbody id="boxoffice-body"></tbody>
		</table>
	</div>
</div>
</body>
<script type="text/javascript">
	document.getElementById("btn-search").addEventListener('click',function(event){
		event.preventDefault();//form안에 있는 버튼은 자동으로 폼의 입력값을 제출해서 페이지가 넘어가게 되는데 이걸 방지해주는 것
		
		var searchDate = document.getElementById("search-date").value;
		searchDate = searchDate.replace(/-/g,'');
		
		var xhr = new XMLHttpRequest();
		xhr.open("GET", 'boxoffice.do?date='+searchDate);
		xhr.send(null);
		xhr.onreadystatechange = function(){
			if(xhr.readyState == 4 && xhr.status == 200){
				var xmlDoc = xhr.responseXML;

				var htmlContent="";
				var boxofficeNodeList = xmlDoc.getElementsByTagName("dailyBoxOffice");
				for(var i=0; i<boxofficeNodeList.length;i++){
					var boxoffice = boxofficeNodeList.item(i);
					
					var rank = boxoffice.getElementsByTagName("rank").item(0).textContent;
					var title = boxoffice.getElementsByTagName("movieNm").item(0).textContent;
					var hireDate = boxoffice.getElementsByTagName("openDt").item(0).textContent;
					var audiDay = boxoffice.getElementsByTagName("audiCnt").item(0).textContent;
					var audiTot = boxoffice.getElementsByTagName("audiAcc").item(0).textContent;
					var salesTot = boxoffice.getElementsByTagName("salesAcc").item(0).textContent;
					var screen = boxoffice.getElementsByTagName("scrnCnt").item(0).textContent;
					
					htmlContent +="<tr>";
					htmlContent +="<td>"+rank+"</td>";
					htmlContent +="<td>"+title+"</td>";
					htmlContent +="<td>"+hireDate+"</td>";
					htmlContent +="<td class='text-right'>"+new Number(audiDay).toLocaleString()+"</td>";
					htmlContent +="<td class='text-right'>"+new Number(audiTot).toLocaleString()+"</td>";
					htmlContent +="<td class='text-right'>"+new Number(salesTot).toLocaleString()+"</td>";
					htmlContent +="<td class='text-right'>"+new Number(screen).toLocaleString()+"</td>";
					htmlContent +="</tr>";
				}
				document.getElementById("boxoffice-body").innerHTML = htmlContent;
			}
		};
	})
</script>
</html>